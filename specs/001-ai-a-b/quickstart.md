# Quickstart: 사적 재판 시스템

**Date**: 2025-09-27  
**Feature**: 001-ai-a-b

## 시스템 개요

사적 재판 시스템은 두 사용자 간의 구조화된 토론을 통해 AI 판결을 제공하는 웹 애플리케이션입니다. 사용자는 언제든지 이탈했다가 돌아와서 진행 상황과 결과를 확인할 수 있습니다.

## 핵심 사용자 시나리오

### 시나리오 1: 완전한 토론 프로세스

**목표**: 두 사용자가 토론을 시작하여 AI 판결까지 받는 전체 과정

**단계**:
1. **사용자 A 로그인 및 방 생성**
   - 로그인 후 "새 토론 시작" 클릭
   - 제목: "환경보호 vs 경제성장 우선순위"
   - 설명: "현재 상황에서 환경보호와 경제성장 중 어느 것이 우선되어야 하는가?"
   - 방 코드 생성: "ENV123"

2. **사용자 B 방 입장**
   - 방 코드 "ENV123" 입력하여 입장
   - 제안된 안건 확인

3. **안건 합의 과정**
   - 사용자 B가 안건 수정 제안: "단기적 vs 장기적 관점에서의 우선순위"
   - 사용자 A가 수정안 수락
   - 최종 안건 합의 완료

4. **주장 제출**
   - 사용자 A (환경보호 측): 주장과 증거 제출
   - 사용자 B (경제성장 측): 주장과 증거 제출

5. **AI 토론 진행**
   - 시스템이 AI 변호사 토론 자동 시작
   - 1차, 2차, 최종 라운드 진행
   - 실시간 진행 상황 표시

6. **AI 판결**
   - 7명 배심원 투표 및 사유
   - 판사 최종 리포트 생성
   - 승패, 근거, 평가 제공

**예상 소요 시간**: 30-45분 (AI 처리 15-20분 포함)

### 시나리오 2: 이탈 후 재접속

**목표**: 사용자가 AI 처리 중 이탈했다가 나중에 돌아와서 결과 확인

**단계**:
1. **진행 중 이탈**
   - AI 토론 시작 후 사용자가 브라우저 종료
   - 백그라운드에서 AI 처리 계속 진행

2. **재접속 및 상태 확인**
   - 몇 시간 후 다시 로그인
   - 대시보드에서 진행 중인 토론 확인
   - 현재 상태: "AI 판결 완료"

3. **결과 열람**
   - 토론 방 재입장
   - 전체 토론 과정 및 최종 판결 확인
   - 상대방과 결과 공유

**핵심 가치**: 비동기 처리로 사용자 편의성 극대화

### 시나리오 3: 안건 합의 실패

**목표**: 안건 합의가 이루어지지 않는 경우 처리

**단계**:
1. **반복적 거절**
   - 사용자 B가 안건을 계속 거절
   - 3회 이상 수정 요청 시 경고 표시

2. **협상 중단**
   - 사용자 A가 협상 중단 선택
   - 방 상태를 "취소됨"으로 변경

3. **새로운 시도**
   - 새로운 방 생성 또는 다른 상대방 찾기

## 기술적 검증 시나리오

### API 엔드포인트 테스트

**방 생성 API**:
```bash
curl -X POST /api/rooms \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "환경보호 vs 경제성장",
    "description": "우선순위 토론"
  }'
```

**예상 응답**:
```json
{
  "id": "uuid",
  "code": "ENV123",
  "title": "환경보호 vs 경제성장",
  "status": "waiting_participant",
  "created_at": "2025-09-27T10:00:00Z"
}
```

**방 입장 API**:
```bash
curl -X POST /api/rooms/join \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"code": "ENV123"}'
```

**상태 폴링 API**:
```bash
curl -X GET /api/rooms/{roomId}/status \
  -H "Authorization: Bearer $TOKEN"
```

### 데이터베이스 상태 검증

**방 생성 후**:
- `rooms` 테이블에 새 레코드 생성
- `status = 'waiting_participant'`
- 고유한 6자리 코드 생성

**참여자 입장 후**:
- `participant_id` 필드 업데이트
- `status = 'agenda_negotiation'`

**AI 처리 중**:
- `jobs` 테이블에 작업 레코드 생성
- `status = 'running'`
- Edge Function에서 처리 진행

## 성능 검증

### 응답 시간 목표
- 방 생성/입장: < 200ms
- 상태 조회: < 100ms
- 주장 제출: < 300ms
- AI 토론 시작: < 500ms (작업 큐 등록)

### 동시성 테스트
- 100명 동시 방 생성
- 50개 방에서 동시 AI 처리
- 데이터베이스 연결 풀 관리

## 보안 검증

### 인증/인가
- 모든 API 요청에 JWT 토큰 필요
- 방 접근 권한 검증 (소유자/참여자만)
- RLS 정책으로 데이터 접근 제어

### 데이터 보호
- 사용자 입력 검증 및 sanitization
- SQL 인젝션 방지
- XSS 공격 방지

## 에러 처리 검증

### 일반적 오류 상황
1. **네트워크 오류**: 재시도 로직 및 사용자 알림
2. **LLM API 오류**: 지수 백오프 재시도 (최대 3회)
3. **데이터베이스 오류**: 트랜잭션 롤백 및 복구
4. **권한 오류**: 명확한 오류 메시지 제공

### 복구 시나리오
- AI 처리 중단 시 재시작 가능
- 부분 완료된 토론 상태 복원
- 데이터 일관성 유지

## 사용자 경험 검증

### 진행 상황 표시
- Stepper 컴포넌트로 현재 단계 표시
- 실시간 상태 업데이트 (폴링)
- 예상 완료 시간 안내

### 접근성
- 키보드 네비게이션 지원
- 스크린 리더 호환성
- 한국어 기본 지원

### 반응형 디자인
- 모바일/태블릿/데스크톱 지원
- 터치 인터페이스 최적화

## 배포 검증

### Vercel 배포
- Next.js 15 App Router 호환성
- 환경 변수 설정 확인
- Edge Functions 배포 테스트

### Supabase 연동
- 데이터베이스 마이그레이션 실행
- RLS 정책 적용 확인
- Edge Functions 배포 및 테스트

### 모니터링
- 애플리케이션 로그 수집
- 성능 메트릭 추적
- 오류 알림 설정

---

**검증 체크리스트**:
- [ ] 전체 사용자 시나리오 완주 가능
- [ ] 이탈/재접속 시나리오 정상 동작
- [ ] 모든 API 엔드포인트 응답 시간 목표 달성
- [ ] 보안 정책 준수 확인
- [ ] 에러 상황 적절한 처리
- [ ] 사용자 경험 품질 기준 충족
- [ ] 배포 환경 정상 동작

**다음 단계**: `/tasks` 명령어로 구현 태스크 생성
